<!DOCTYPE html>

<html>
  <head>
    <title>AR Demo</title>
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/Ar.js/1.6.2/aframe/build/aframe-ar.js"></script>
    <script src="src/roslib.js"></script>
  </head>

  <body style="margin: 0px; overflow: hidden;">
    <a-scene embedded arjs>
      <a-marker preset="hiro">
        <a-octahedron position="0 0.5 0" radius="0.1" material="color: #87CEEB; opacity: 0.7;" size-updater></a-octahedron>
      </a-marker>
      <a-entity camera></a-entity>

      <script>
        console.log('log test');
        var my_ip = "192.168.0.45"
        var ros = new ROSLIB.Ros();

        ros.on('error', function(error) {
          console.log('Error connecting to ROS: ', error);
        });

        ros.on('connection', function() {
          console.log('Connected to ROS');
        });

        ros.on('close', function() {
          console.log('Connection to ROS closed');
        });
        
        ros.connect('ws://' + my_ip + ':9090');

        var marker = document.querySelector("a-marker");
        var box = marker.querySelector("a-octahedron");

        var listener = new ROSLIB.Topic({
          ros : ros,
          name : '/listener',
          messageType : 'std_msgs/String'
        });

        // Your variable that controls the size (change this value dynamically)
        var dynamicSize = 0.1;

        // Function to update the box size based on the dynamicSize variable
        function updateSize() {
          box.setAttribute("scale", `${dynamicSize} ${dynamicSize} ${dynamicSize}`);
          console.log('updating size. . . . . . . . .');
        }

        listener.subscribe(function(message) {
          dynamicSize = 0.75;
          updateSize();
          console.log('Received message on ' + listener.name + ': ' + message.data);
        });
      </script>
    </a-scene>
  </body>
</html>
